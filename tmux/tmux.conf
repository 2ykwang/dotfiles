# =====================================
# tmux configuration
# =====================================

# -----------------------------------------
# General Settings
# -----------------------------------------

# Prefix: Ctrl+b -> Ctrl+a (더 누르기 쉬움)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# 설정 리로드: prefix + r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# 터미널 색상 (True Color 지원)
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# 히스토리 크기
set -g history-limit 50000

# ESC 지연 제거 (vim 사용 시 중요)
set -sg escape-time 0

# 포커스 이벤트 (vim autoread 등에 필요)
set -g focus-events on

# -----------------------------------------
# Window & Pane
# -----------------------------------------

# 인덱스 1부터 시작 (0은 키보드 왼쪽 끝이라 불편)
set -g base-index 1
setw -g pane-base-index 1

# 창 닫으면 번호 재정렬
set -g renumber-windows on

# 창 분할: | (수평), - (수직) - 현재 경로 유지
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# 새 창 - 현재 경로 유지
bind c new-window -c "#{pane_current_path}"

# -----------------------------------------
# Pane Navigation
# -----------------------------------------

# Alt + 방향키: 패널 이동 (prefix 없이)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# prefix + hjkl: 패널 이동 (vim 스타일)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# prefix + HJKL: 패널 크기 조절
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# -----------------------------------------
# Mouse
# -----------------------------------------

set -g mouse on

# -----------------------------------------
# Copy Mode (vi 스타일)
# -----------------------------------------

setw -g mode-keys vi

# v로 선택 시작, y로 복사
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# -----------------------------------------
# Plugins (TPM으로 관리)
# -----------------------------------------

# TPM (Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'

# sensible: 합리적인 기본 설정
set -g @plugin 'tmux-plugins/tmux-sensible'

# resurrect: 세션 저장/복원 (prefix + Ctrl-s 저장, prefix + Ctrl-r 복원)
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-capture-pane-contents 'on'  # 패널 내용도 저장
set -g @resurrect-strategy-vim 'session'      # vim 세션 복원
set -g @resurrect-strategy-nvim 'session'     # neovim 세션 복원

# continuum: 자동 저장/복원
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'                # tmux 시작 시 자동 복원
set -g @continuum-save-interval '15'          # 15분마다 자동 저장

# yank: 시스템 클립보드로 복사
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @yank-selection 'clipboard'            # 클립보드 사용

# prefix-highlight: prefix 키 누르면 상태바에 표시
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_show_sync_mode 'on'

# catppuccin: 테마 (mocha 스타일)
set -g @plugin 'catppuccin/tmux#v2.1.3'
set -g @catppuccin_flavor 'mocha'             # latte, frappe, macchiato, mocha

# catppuccin 상태바 설정
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_number_position "right"

set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"

set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W"

set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"

# 상태바 모듈
set -g status-left "#{prefix_highlight}"
set -g status-right "#{E:@catppuccin_status_session}"

# -----------------------------------------
# Initialize TPM (맨 마지막에 위치해야 함)
# -----------------------------------------
run '~/.tmux/plugins/tpm/tpm'
